<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mybatis.dao.AppUserMapper">

    <resultMap id="BaseResultMap" type="AppUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="username" property="username" jdbcType="VARCHAR"/>
        <result column="password1" property="password1" jdbcType="VARCHAR"/>
        <result column="enabled" property="enabled" jdbcType="BIT"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="birth_date" property="birthDate" jdbcType="DATE"/>
        <result column="attendance_ranking" jdbcType="INTEGER" property="attendanceRanking"/>
        <result column="notify_via_push" jdbcType="BIT" property="notifyViaPush"/>
        <result column="notify_via_email" jdbcType="BIT" property="notifyViaEmail"/>
        <result column="android_push_token" jdbcType="VARCHAR" property="androidPushToken"/>

    </resultMap>

    <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="AppUser">
        <result column="avatar" jdbcType="BINARY" property="avatar"/>
    </resultMap>

    <resultMap id="BaseResultMapEventType" type="mybatis.model.basic.EventType">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="type_name" property="typeName" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="UserEventFilter" type="mybatis.model.complex.UserEventFilter">

        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="username" property="username" jdbcType="VARCHAR"/>
        <result column="password1" property="password1" jdbcType="VARCHAR"/>
        <result column="enabled" property="enabled" jdbcType="BIT"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="birth_date" property="birthDate" jdbcType="DATE"/>
        <result column="attendance_ranking" jdbcType="INTEGER" property="attendanceRanking"/>
        <result column="notify_via_push" jdbcType="BIT" property="notifyViaPush"/>
        <result column="notify_via_email" jdbcType="BIT" property="notifyViaEmail"/>
        <result column="android_push_token" jdbcType="VARCHAR" property="androidPushToken"/>

        <collection property="eventTypes" ofType="mybatis.model.basic.EventType" javaType="List">
            <id column="id_event_type" property="id" jdbcType="BIGINT"/>
            <result column="type_name" property="typeName" jdbcType="VARCHAR"/>
        </collection>

    </resultMap>

    <resultMap id="FullProfile" type="mybatis.model.complex.FullProfile">

        <id column="user_id" property="id" jdbcType="BIGINT"/>
        <result column="username" property="username" jdbcType="VARCHAR"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="birth_date" property="birthDate" jdbcType="DATE"/>
        <result column="attendance_ranking" jdbcType="INTEGER" property="attendanceRanking"/>
        <result column="notify_via_push" jdbcType="BIT" property="notifyViaPush"/>
        <result column="notify_via_email" jdbcType="BIT" property="notifyViaEmail"/>
        <result column="android_push_token" jdbcType="VARCHAR" property="androidPushToken"/>

        <collection property="eventTypes" ofType="mybatis.model.basic.EventType" javaType="List">
            <id column="id_event_type" property="id" jdbcType="BIGINT"/>
            <result column="type_name" property="typeName" jdbcType="VARCHAR"/>
        </collection>

        <collection property="subscribedRegions" ofType="mybatis.model.complex.Region" javaType="List">
            <id column="region_id" property="id" jdbcType="BIGINT" />
            <result column="region_name" property="name" jdbcType="VARCHAR" />
            <result column="region_area1" property="area1" jdbcType="VARCHAR" />
            <result column="region_id_country" property="idCountry" jdbcType="BIGINT" />
        </collection>

    </resultMap>

    <resultMap id="ProfileResultMap" type="mybatis.model.complex.AppUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="username" property="username" jdbcType="VARCHAR"/>
        <result column="enabled" property="enabled" jdbcType="BIT"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="birth_date" property="birthDate" jdbcType="DATE"/>
        <result column="avatar" jdbcType="BINARY" property="avatar"/>
        <result column="attendance_ranking" jdbcType="INTEGER" property="attendanceRanking"/>

    </resultMap>

    <!-- custom start  -->
    <resultMap id="UserRoleMap" type="mybatis.model.basic.UserRole">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Fri Dec 12 21:32:13 CET 2014.
        -->
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="description" property="description" jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="Base_Column_List">
    webserver.app_user.id, username, password1, enabled, email, birth_date, notify_via_push, notify_via_email, attendance_ranking
  </sql>


    <sql id="User_Column_List">
    app_user.id, app_user.username, app_user.enabled, app_user.email, app_user.birth_date,  app_user.notify_via_push, app_user.notify_via_email, app_user.attendance_ranking
  </sql>

    <sql id="Profile_Column_List">
    id, username, enabled, email, birth_date, avatar, attendance_ranking
  </sql>

    <sql id="Full_profile_Column_List">
        app_user.id as user_id, username, email, birth_date, avatar, attendance_ranking, notify_via_push, notify_via_email, id_event_type, type_name,
        region.id as region_id,  region.name as  region_name,  region.area1 as region_area1,  region.id_country as region_id_country
    </sql>

    <select id="selectProfileByPrimaryKey" resultMap="BaseResultMap" parameterType="Long">
        select
        <include refid="Profile_Column_List"/>
        from webserver.app_user
        where id = #{id,jdbcType=BIGINT}
    </select>

    <select id="selectFullProfileByPrimaryKey" resultMap="FullProfile" parameterType="Long">
        select
        <include refid="Full_profile_Column_List"/>
        from webserver.app_user
        join webserver.event_filter on webserver.event_filter.id_user = webserver.app_user.id
        join webserver.event_type on webserver.event_filter.id_event_type = webserver.event_type.id
        join webserver.locality_filter on webserver.locality_filter.id_user = webserver.app_user.id
        join webserver.region on webserver.locality_filter.id_region = webserver.region.id
        where app_user.id = #{id,jdbcType=BIGINT}
    </select>

    <select id="selectRolesList" parameterType="java.lang.Long" resultMap="UserRoleMap">
    select
    webserver.app_user.id as id, username, password1, enabled, email, birth_date, webserver.user_role.description as description
    from webserver.app_user
    join webserver.user_role_mn on webserver.user_role_mn.id_user = webserver.app_user.id
    join webserver.user_role on webserver.user_role_mn.id_role = webserver.user_role.id
    where webserver.app_user.id = #{id,jdbcType=BIGINT}
  </select>

    <select id="selectUsersWithRole" resultMap="BaseResultMap" parameterType="Long">
        select
        <include refid="Base_Column_List"/>
        from webserver.app_user
        join webserver.user_role_mn on webserver.app_user.id = webserver.user_role_mn.id_user
        where webserver.user_role_mn.id_role = #{id_role,jdbcType=BIGINT}
    </select>


    <insert id="insert" parameterType="mybatis.model.complex.AppUser">

        <!-- doplni id po insertu do objektu kterej jsme do nej nahrali  -->
        <selectKey order="AFTER" keyProperty="id" resultType="long">
            SELECT currval('app_user_id_seq')
        </selectKey>

        insert into webserver.app_user (username, password1,enabled, email, birth_date,notify_via_push,notify_via_email)
        values (#{username,jdbcType=VARCHAR}, #{password1,jdbcType=VARCHAR}, #{enabled,jdbcType=BIT},
        #{email,jdbcType=VARCHAR},
        #{birthDate,jdbcType=DATE},#{notifyViaPush,jdbcType=BIT},#{notifyViaEmail,jdbcType=BIT})
    </insert>


    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        select
        <include refid="Base_Column_List"/>
        from webserver.app_user
        where id = #{id,jdbcType=BIGINT}
    </select>


    <select id="selectByUsername" resultMap="BaseResultMap" parameterType="String">
        <!--
          custom method for selecting by username
        -->
        select
        <include refid="Base_Column_List"/>
        from webserver.app_user
        where username = #{username,jdbcType=VARCHAR}
    </select>

    <select id="selectUsersWithRegionByRegionID" resultMap="BaseResultMap" parameterType="Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed Mar 11 15:22:30 CET 2015.
        -->
        select
        <include refid="User_Column_List"/>
        from webserver.app_user
        join webserver.locality_filter on webserver.locality_filter.id_user = webserver.app_user.id
        where locality_filter.id_region = #{ídRegion,jdbcType=BIGINT}
    </select>


    <select id="selectByUsernameWithEventFilter" resultMap="UserEventFilter" parameterType="String">

    select
      app_user.id, username, password1, enabled, email, birth_date,
      event_type.type_name as type_name, event_filter.id_event_type as id_event_type,
       notify_via_push, notify_via_email, attendance_ranking
    from webserver.app_user
    left join webserver.event_filter on webserver.event_filter.id_user = webserver.app_user.id
    left join webserver.event_type on webserver.event_filter.id_event_type = webserver.event_type.id
    where username = #{username,jdbcType=VARCHAR}
  </select>

    <delete id="deleteByPrimaryKey" parameterType="Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        delete from webserver.app_user
        where id = #{id,jdbcType=BIGINT}
    </delete>

    <update id="updateByPrimaryKeyWithBLOBs" parameterType="AppUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Mar 12 17:21:26 CET 2015.
        -->
        update webserver.app_user
        set username = #{username,jdbcType=VARCHAR},
        password1 = #{password1,jdbcType=VARCHAR},
        enabled = #{enabled,jdbcType=BIT},
        email = #{email,jdbcType=VARCHAR},
        birth_date = #{birthDate,jdbcType=DATE},
        avatar = #{avatar,jdbcType=BINARY},
        notify_via_push = #{notifyViaPush,jdbcType=BIT},
        notify_via_email = #{notifyViaEmail,jdbcType=BIT}
        where id = #{id,jdbcType=BIGINT}
    </update>


    <update id="updateByPrimaryKey" parameterType="AppUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        update webserver.app_user
        set username = #{username,jdbcType=VARCHAR},
        password1 = #{password1,jdbcType=VARCHAR},
        enabled = #{enabled,jdbcType=BIT},
        email = #{email,jdbcType=VARCHAR},
        birth_date = #{birthDate,jdbcType=DATE},
        notify_via_push = #{notifyViaPush,jdbcType=BIT},
        notify_via_email = #{notifyViaEmail,jdbcType=BIT}
        where id = #{id,jdbcType=BIGINT}
    </update>

    <update id="updateByPrimaryKeySelective" parameterType="AppUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Mar 30 17:21:19 CEST 2015.
        -->
        update webserver.app_user
        <set>
            <if test="username != null">
                username = #{username,jdbcType=VARCHAR},
            </if>
            <if test="password1 != null">
                password1 = #{password1,jdbcType=VARCHAR},
            </if>
            <if test="enabled != null">
                enabled = #{enabled,jdbcType=BIT},
            </if>
            <if test="email != null">
                email = #{email,jdbcType=VARCHAR},
            </if>
            <if test="birthDate != null">
                birth_date = #{birthDate,jdbcType=DATE},
            </if>
            <if test="attendanceRanking != null">
                attendance_ranking = #{attendanceRanking,jdbcType=INTEGER},
            </if>
            <if test="notifyViaPush != null">
                notify_via_push = #{notifyViaPush,jdbcType=BIT},
            </if>
            <if test="notifyViaEmail != null">
                notify_via_email = #{notifyViaEmail,jdbcType=BIT},
            </if>
            <if test="androidPushToken != null">
                android_push_token = #{androidPushToken,jdbcType=VARCHAR},
            </if>
            <if test="avatar != null">
                avatar = #{avatar,jdbcType=BINARY},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>

</mapper>