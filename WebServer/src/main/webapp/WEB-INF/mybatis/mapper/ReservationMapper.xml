<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mybatis.dao.ReservationMapper">
    <resultMap id="BaseResultMap" type="Reservation_B">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="id_event" property="idEvent" jdbcType="BIGINT"/>
        <result column="id_user" property="idUser" jdbcType="BIGINT"/>
        <result column="time" property="time" jdbcType="TIMESTAMP"/>
        <result column="confirmed" property="confirmed" jdbcType="BIT"/>
        <result column="confirm_pending" property="confirmPending" jdbcType="BIT"/>
        <result column="invitation_pending" property="invitationPending" jdbcType="BIT"/>
        <result column="attended" jdbcType="BIT" property="attended" />
    </resultMap>

    <resultMap id="ReservationWithUserMap" type="ReservationWithUser">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="id_event" property="idEvent" jdbcType="BIGINT"/>
        <result column="time" property="time" jdbcType="TIMESTAMP"/>
        <result column="confirmed" property="confirmed" jdbcType="BIT"/>
        <result column="confirm_pending" property="confirmPending" jdbcType="BIT"/>
        <result column="invitation_pending" property="invitationPending" jdbcType="BIT"/>
        <result column="attended" jdbcType="BIT" property="attended" />
        <result column="id_user" property="userId" jdbcType="BIGINT"/>
        <result column="username" property="username" jdbcType="VARCHAR" />
    </resultMap>


    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        id, id_event, id_user, time, confirmed, confirm_pending, invitation_pending, attended
    </sql>

    <sql id="Reservation_With_User_List">
        id, id_event,  time, confirmed, confirm_pending, invitation_pending, id_user, username, attended
    </sql>

    <select id="selectReservationsWithUserForEventByEventId" resultMap="ReservationWithUserMap" parameterType="java.lang.Long">
        select
        webserver.reservation.id as id, id_event, time, confirmed, confirm_pending, invitation_pending, attended,
        webserver.reservation.id_user as id_user, webserver.app_user.username as username
        from webserver.reservation
        join webserver.app_user on webserver.app_user.id = webserver.reservation.id_user
        where id_event = #{id_event,jdbcType=BIGINT}
    </select>

    <select id="selectPendingInvitationsByUserID" resultMap="BaseResultMap" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        select
        <include refid="Base_Column_List"/>
        from webserver.reservation
        where id_user = #{id_user,jdbcType=BIGINT} and invitation_pending = TRUE
    </select>



    <select id="selectReservationsUserConfirmedByUserID" resultMap="BaseResultMap" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        select
        <include refid="Base_Column_List"/>
        from webserver.reservation
        where id_user = #{id_user,jdbcType=BIGINT} and confirmed = TRUE
    </select>





    <select id="selectReservationsForEventByEventId" resultMap="BaseResultMap" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        select
        <include refid="Base_Column_List"/>
        from webserver.reservation
        where id_event = #{id_event,jdbcType=BIGINT}
    </select>

    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        select
        <include refid="Base_Column_List"/>
        from webserver.reservation
        where id = #{id,jdbcType=BIGINT}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        delete from webserver.reservation
        where id = #{id,jdbcType=BIGINT}
    </delete>

    <delete id="deleteByUserAndEventIDs" parameterType="2Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        delete from webserver.reservation
        where id_user = #{param1,jdbcType=BIGINT} and id_event = #{param2,jdbcType=BIGINT}
    </delete>



    <insert id="insert" parameterType="Reservation_B">

        <!-- doplni id po insertu do objektu kterej jsme do nej nahrali  -->
        <selectKey order="AFTER" keyProperty="id" resultType="long">
            SELECT currval('reservation_id_seq')
        </selectKey>

        insert into webserver.reservation (id_event, id_user, time, confirmed, confirm_pending, invitation_pending, attended )
        values (#{idEvent,jdbcType=BIGINT}, #{idUser,jdbcType=BIGINT}, #{time,jdbcType=TIMESTAMP}
        ,#{confirmed,jdbcType=BIT},#{confirmPending,jdbcType=BIT},#{invitationPending,jdbcType=BIT}, #{attended,jdbcType=BIT})
    </insert>

    <insert id="insertSelective" parameterType="Reservation_B">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        insert into webserver.reservation
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="idEvent != null">
                id_event,
            </if>
            <if test="idUser != null">
                id_user,
            </if>
            <if test="time != null">
                time,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=BIGINT},
            </if>
            <if test="idEvent != null">
                #{idEvent,jdbcType=BIGINT},
            </if>
            <if test="idUser != null">
                #{idUser,jdbcType=BIGINT},
            </if>
            <if test="time != null">
                #{time,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="Reservation_B">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Dec 22 14:05:31 CET 2014.
        -->
        update webserver.reservation
        <set>
            <if test="idEvent != null">
                id_event = #{idEvent,jdbcType=BIGINT},
            </if>
            <if test="idUser != null">
                id_user = #{idUser,jdbcType=BIGINT},
            </if>
            <if test="time != null">
                time = #{time,jdbcType=TIMESTAMP},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>

    <update id="updateByPrimaryKey" parameterType="Reservation_B">

        update webserver.reservation
        set id_event = #{idEvent,jdbcType=BIGINT},
        id_user = #{idUser,jdbcType=BIGINT},
        time = #{time,jdbcType=TIMESTAMP},
        confirmed = #{confirmed,jdbcType=BIT},
        confirm_pending = #{confirmPending,jdbcType=BIT},
        invitation_pending = #{invitationPending,jdbcType=BIT},
        attended = #{attended,jdbcType=BIT}
        where id = #{id,jdbcType=BIGINT}
    </update>

    <update id="updateByForeignKeysSelective" parameterType="Reservation_B">
        update webserver.reservation
        <set>
            <if test="time != null">
                time = #{time,jdbcType=TIMESTAMP},
            </if>
            <if test="confirmed != null">
                confirmed = #{confirmed,jdbcType=BIT},
            </if>
            <if test="confirmPending != null">
                confirm_pending = #{confirmPending,jdbcType=BIT},
            </if>
            <if test="invitationPending != null">
                invitation_pending = #{invitationPending,jdbcType=BIT},
            </if>
            <if test="attended != null">
                attended = #{attended,jdbcType=BIT},
            </if>
        </set>
        where id_event = #{idEvent,jdbcType=BIGINT} and  id_user = #{idUser,jdbcType=BIGINT}
    </update>


</mapper>